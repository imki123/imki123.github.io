<!DOCTYPE html><html data-react-helmet="lang" lang="en_US"><head><meta charset="utf-8"><link href="/images/imcat_64.png" rel="icon"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="#000000" name="theme-color"><meta content="/images/imcat_800x400.png" property="image"><meta content="/images/imcat_800x400.png" property="og:image"><meta content="HZicODInbBKemFyMPNAa0hZFqxXrvctIKQjKNGjc1g8" name="google-site-verification"><meta content="6a36bfcd58834db8c5d1e177f7e2bb50f07c18bb" name="naver-site-verification"><link href="/images/imcat.png" rel="apple-touch-icon"><link href="/styles/atom-one-dark.css" rel="stylesheet"><link href="/styles/index.css" rel="stylesheet"><script src="/lib/highlight.pack.js"></script><script src="/lib/naveridlogin_js_sdk_2.0.0.js"></script><link href="https://static.nid.naver.com" rel="preconnect"><script src="/lib/kakao.min.js"></script><meta content="profile email" name="google-signin-scope"><meta content="605411712139-eb3qqicskmkal2i9u26ppdhoq2jt0bd8.apps.googleusercontent.com" name="google-signin-client_id"><link href="/manifest.json" rel="manifest"><title>비동기함수를 반복문에서 사용하는 방법(setTimeout, for, promise, setInterval, 실행컨텍스트)</title><script type="text/javascript">!function(i){if(i.search){var a={};i.search.slice(1).split("&").forEach((function(i){var l=i.split("=");a[l[0]]=l.slice(1).join("=").replace(/~and~/g,"&")})),void 0!==a.p&&window.history.replaceState(null,null,i.pathname.slice(0,-1)+(a.p||"")+(a.q?"?"+a.q:"")+i.hash)}}(window.location)</script><link href="/static/css/2.3c515868.chunk.css" rel="stylesheet"><link href="/static/css/main.11650366.chunk.css" rel="stylesheet"><link href="https://static.nid.naver.com" rel="preconnect"><style data-jss="" data-meta="MuiSvgIcon">.MuiSvgIcon-root{fill:currentColor;width:1em;height:1em;display:inline-block;font-size:1.5rem;transition:fill .2s cubic-bezier(.4,0,.2,1) 0s;flex-shrink:0;user-select:none}.MuiSvgIcon-colorPrimary{color:#3f51b5}.MuiSvgIcon-colorSecondary{color:#f50057}.MuiSvgIcon-colorAction{color:rgba(0,0,0,.54)}.MuiSvgIcon-colorError{color:#f44336}.MuiSvgIcon-colorDisabled{color:rgba(0,0,0,.26)}.MuiSvgIcon-fontSizeInherit{font-size:inherit}.MuiSvgIcon-fontSizeSmall{font-size:1.25rem}.MuiSvgIcon-fontSizeLarge{font-size:2.1875rem}</style><link href="/images/imcat_800x400.png" rel="image_src" data-react-helmet="true"><meta content="/images/imcat_800x400.png" data-react-helmet="true" itemprop="image"><meta content="/images/imcat_800x400.png" data-react-helmet="true" property="og:image"><meta content="1200" data-react-helmet="true" property="og:image:width"><meta content="630" data-react-helmet="true" property="og:image:height"><meta content="/images/imcat_800x400.png" data-react-helmet="true" name="twitter:image"><meta content="임기의 코딩 블로그" data-react-helmet="true" property="og:site_name"><meta content="" data-react-helmet="true" property="og:locale"><meta content="website" data-react-helmet="true" property="og:type"><meta content="임기의 코딩 블로그" data-react-helmet="true" property="fb:pages"><meta content="summary_large_image" data-react-helmet="true" name="twitter:card"><meta content="@임기의 코딩 블로그" data-react-helmet="true" name="twitter:site"><link href="https://blog-imki123-backend.herokuapp.com" rel="preconnect"><link href="https://phinf.pstatic.net" rel="preconnect"><link href="https://phinf.pstatic.net" rel="preconnect"><style data-jss="" data-meta="MuiSvgIcon">.MuiSvgIcon-root{fill:currentColor;width:1em;height:1em;display:inline-block;font-size:1.5rem;transition:fill .2s cubic-bezier(.4,0,.2,1) 0s;flex-shrink:0;user-select:none}.MuiSvgIcon-colorPrimary{color:#3f51b5}.MuiSvgIcon-colorSecondary{color:#f50057}.MuiSvgIcon-colorAction{color:rgba(0,0,0,.54)}.MuiSvgIcon-colorError{color:#f44336}.MuiSvgIcon-colorDisabled{color:rgba(0,0,0,.26)}.MuiSvgIcon-fontSizeInherit{font-size:inherit}.MuiSvgIcon-fontSizeSmall{font-size:1.25rem}.MuiSvgIcon-fontSizeLarge{font-size:2.1875rem}</style><link href="https://blog-imki123-backend.herokuapp.com" rel="preconnect"><meta content="안녕하세요. 임기입니다. 😄  오늘은 자바스크립트에서 흔하게 발생하는 비동기함수를 반복문에서 사용하는 방법을 알아볼거에요.  비동기함수는 대표적으로 타임함수(setTimeout, setInterval)가 있고, fetch 등의 AJAX 함수들, 또는 Promise를 리턴하는 함수들이 있겠습니다.  그러면 반복문과 비동기 함수를 같이 사용하는 방법을 알아봅시다. 대표적인 반복문인 for로 예시를 들어볼게요. //for문 안에서 setTimeout() 함수 사용하기 for(var i=0; i<4; i++){   setTimeout(() => {    console.log(i) // 어떤 값이 출력될까요???   },1000) }​  자, for가 0~3까지 4번 실행되는 반복문을 만들고, 그 안에 setTimeout함수를 이용해서 1초 후에 i값이 콘솔에 출력되도록 하는 코드입니다. 과연 의도대로 출력이 될까요?? 만약 그랬다면 문제로 내지 않았겠죠? ㅎㅎ 저희가 원한 결과는 1초 마다 0, 1, 2, 3을 한번씩 출력하는 것입니다. 하지만 실제 결과는 1초 후에 4를 거의동시에 4번 출력하게 됩니다. 의도와 상당히 다른 결과가 나와버렸죠? 이제 이 문제를 해결해봅시다.  이 문제를 풀기 위해서는 실행컨텍스트와 스코프, 호이스팅 개념을 알고 있어야합니다. 추가적으로 클로저와 즉시실행함수, 콜스택, 이벤트루프 까지 알고 있으면 더 좋습니다. 한번에 다 다루기엔 좀 어렵죠? 😭 우선 실행컨텍스트에 대해서 알아봅시다. 자바스크립트엔진은 스크립트를 실행하다가 함수를 만나게되면 실행컨텍스트라는 것을 생성하게 되는데요. 이 실행컨텍스트에 함수가 실행될 때의 환경을 저장하게 됩니다. 이렇게 만들어진 실행컨텍스트는 자신만의 스코프(유효범위)를 갖게됩니다.예를 들어볼까요? var x = 10 var y = 20 function print(){   var x = 5   console.log(x, y) } print()  자 위의 결과는 어떻게 될까요? 어렵지 않게 5와 20이 출력된다는걸 알 수 있습니다. 그러면 실행컨텍스트 입장에서 살펴봅시다.  GO( x=10, y=20, print = function ) print 컨텍스트( x=5 ) 참조한 변수 : x=5, y=20 우선 자바스크립트가 실행되면 글로벌 오브젝트(GO)를 생성하게됩니다. GO에는 전역 변수들과 함수들이 프로퍼티로 저장되게 됩니다. 여기서는 x = 10, y = 20, print = function 정도가 저장되어 있겠네요.  자바스크립트엔진이 print() 함수를 실행하게되면 새로운 실행컨텍스트가 생성됩니다. print 컨텍스트는 x = 5를 프로퍼티로 저장합니다.  그렇다면 y는 어디서 찾을 수 있을까요? print 컨텍스트에 y라는 변수는 들어있지 않으므로 바로 상위 컨텍스트에서 y를 찾게 됩니다. 다행히 y가 GO에 저장되어 있어서 y가 20인 것을 알 수 있겠네요. 만약에 GO에도 y가 선언되어있지 않다면 'y is not defined' 라는 컨퍼런스 에러를 발생시킵니다.  즉, 변수를 참조할 땐 함수가 실행된 컨텍스트 내부를 먼저 살펴보고 없으면 상위 컨텍스트를 계속해서 찾게됩니다.   이제 for문 예시를 실행컨텍스트 입장에서 살펴봅시다. //for문 안에서 setTimeout() 함수 사용하기 for(var i=0; i<4; i++){   setTimeout(() => {    console.log(i) // 어떤 값이 출력될까요???   },1000) }​ GO( i=0 ) for 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) for문 안의 var i는 전역변수로 호이스팅됩니다. 그리고 for문이 시작되면 0으로 할당되죠. 그 다음 곧바로 setTimeout 함수를 만나게 되죠. 문제는 setTimeout 함수는 1초가 지날 때 까지 내부 함수를 실행하지 않고 대기한다는 겁니다.   for문은 속도가 아주 빠르므로 1초보다 훨씬 짧은 시간에 다음 i로 넘어가게 되고 또 다시 setTimeout을 실행합니다. 이렇게 아주 짧은 시간에 0~3까지 4번의 setTimeout이 실행됩니다. for문이 끝났을 때의 실행컨텍스트는 아래와 같습니다. GO( i=4 ) for 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) 자, 이제 1초가 지났습니다. 3,4,5,6의 setTimeout 함수는 i 프로퍼티를 내부에 가지고 있지 않습니다. 따라서 상위에 있는 for 컨텍스트를 바라보게 되죠. for에도 i가 없으므로 GO로 갑니다. GO는 i를 4로 저장하고 있네요. 결과는 어떻게 될까요? 당연히 4를 거의 동시에 4번 출력하게 됩니다.  이제 문제를 해결해볼까요?? 중요한 점은 setTimeout 함수가 참조하는 i가 1초 후에도 변함없이 유지 되어야한다는 겁니다. for 컨텍스트는 i를 빠르게 변경하므로 i를 유지할 수가 없죠. 이것은 즉시실행함수(IIFE)를 이용하면 해결할 수 있습니다.  즉시실행함수는 함수를 선언과 동시에 실행하는 것을 말합니다. 예시를 보죠. (x => {   console.log(x) })(5)  위 결과는 5를 출력합니다. 익명함수 x => {...}를 ( )로 감싸고 곧바로 인자(5)를 넘겨주면 내부 함수가 실행되는 원리입니다. 이제 실행컨텍스트를 살펴볼까요? GO ( empty ) 즉시실행함수 컨텍스트 ( x = 5 ) console.log는 x를 참조합니다. x는 즉시실행함수에 저장되어 있네요. 즉 console.log는 5를 출력하게 됩니다.  감이 좀 오시나요? 즉시 실행함수는 새로운 컨텍스트를 만들어주고, 인자로 받은 값을 컨텍스트에 저장할 수 있습니다. 바로 이 점을 활용하는거죠.  [솔루션] 아래가 바로 정답 코드입니다. for(var i=0; i<4; i++){   (x => {     setTimeout(() => {       console.log(x)     },1000*x)   })(i) }​  1초 후의 실행컨텍스트를 살펴봅시다. GO( i=4 ) for 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=0 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=1 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=2 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=3 ) setTimeout 컨텍스트 ( empty ) 자, 어떤가요? 1초가 지난 후에 setTimeout이 실행되어도 x가 저장되어있으므로 x초마다 x를 출력할 수 있겠지요? 긴 글 읽어주셔서 감사합니다. 😍   추가) for문에서 let으로 만든 변수는 반복될 때마다 새로운 실행컨텍스트를 생성합니다. 따라서 var 변수를 let으로 변경하기만 해도 i값을 유지할 수 있답니다. ^^ 아래 코드로 간단하게 해결이 되네요! for(let i=0; i<4; i++){   setTimeout(() => {     console.log(i)   },1000*i) }​ GO( empty ) for 컨텍스트 ( i = 0) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 1) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 2) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 3) setTimeout 컨텍스트 ( empty )  참고) 같은 비동기 함수인 setInterval()을 이용하는 방법도 있어요. 취향대로 선택하셔서 사용하세요. ^^;  // setInterval() 사용 let i = 0 console.log(i++) let interval = setInterval(() => {  console.log(i++)  if(i >= 4) clearInterval(interval) }, 1000)​ " data-react-helmet="true" name="description"><meta content="비동기함수를 반복문에서 사용하는 방법(setTimeout, for, promise, setInterval, 실행컨텍스트)" data-react-helmet="true" property="og:title"><meta content="안녕하세요. 임기입니다. 😄  오늘은 자바스크립트에서 흔하게 발생하는 비동기함수를 반복문에서 사용하는 방법을 알아볼거에요.  비동기함수는 대표적으로 타임함수(setTimeout, setInterval)가 있고, fetch 등의 AJAX 함수들, 또는 Promise를 리턴하는 함수들이 있겠습니다.  그러면 반복문과 비동기 함수를 같이 사용하는 방법을 알아봅시다. 대표적인 반복문인 for로 예시를 들어볼게요. //for문 안에서 setTimeout() 함수 사용하기 for(var i=0; i<4; i++){   setTimeout(() => {    console.log(i) // 어떤 값이 출력될까요???   },1000) }​  자, for가 0~3까지 4번 실행되는 반복문을 만들고, 그 안에 setTimeout함수를 이용해서 1초 후에 i값이 콘솔에 출력되도록 하는 코드입니다. 과연 의도대로 출력이 될까요?? 만약 그랬다면 문제로 내지 않았겠죠? ㅎㅎ 저희가 원한 결과는 1초 마다 0, 1, 2, 3을 한번씩 출력하는 것입니다. 하지만 실제 결과는 1초 후에 4를 거의동시에 4번 출력하게 됩니다. 의도와 상당히 다른 결과가 나와버렸죠? 이제 이 문제를 해결해봅시다.  이 문제를 풀기 위해서는 실행컨텍스트와 스코프, 호이스팅 개념을 알고 있어야합니다. 추가적으로 클로저와 즉시실행함수, 콜스택, 이벤트루프 까지 알고 있으면 더 좋습니다. 한번에 다 다루기엔 좀 어렵죠? 😭 우선 실행컨텍스트에 대해서 알아봅시다. 자바스크립트엔진은 스크립트를 실행하다가 함수를 만나게되면 실행컨텍스트라는 것을 생성하게 되는데요. 이 실행컨텍스트에 함수가 실행될 때의 환경을 저장하게 됩니다. 이렇게 만들어진 실행컨텍스트는 자신만의 스코프(유효범위)를 갖게됩니다.예를 들어볼까요? var x = 10 var y = 20 function print(){   var x = 5   console.log(x, y) } print()  자 위의 결과는 어떻게 될까요? 어렵지 않게 5와 20이 출력된다는걸 알 수 있습니다. 그러면 실행컨텍스트 입장에서 살펴봅시다.  GO( x=10, y=20, print = function ) print 컨텍스트( x=5 ) 참조한 변수 : x=5, y=20 우선 자바스크립트가 실행되면 글로벌 오브젝트(GO)를 생성하게됩니다. GO에는 전역 변수들과 함수들이 프로퍼티로 저장되게 됩니다. 여기서는 x = 10, y = 20, print = function 정도가 저장되어 있겠네요.  자바스크립트엔진이 print() 함수를 실행하게되면 새로운 실행컨텍스트가 생성됩니다. print 컨텍스트는 x = 5를 프로퍼티로 저장합니다.  그렇다면 y는 어디서 찾을 수 있을까요? print 컨텍스트에 y라는 변수는 들어있지 않으므로 바로 상위 컨텍스트에서 y를 찾게 됩니다. 다행히 y가 GO에 저장되어 있어서 y가 20인 것을 알 수 있겠네요. 만약에 GO에도 y가 선언되어있지 않다면 'y is not defined' 라는 컨퍼런스 에러를 발생시킵니다.  즉, 변수를 참조할 땐 함수가 실행된 컨텍스트 내부를 먼저 살펴보고 없으면 상위 컨텍스트를 계속해서 찾게됩니다.   이제 for문 예시를 실행컨텍스트 입장에서 살펴봅시다. //for문 안에서 setTimeout() 함수 사용하기 for(var i=0; i<4; i++){   setTimeout(() => {    console.log(i) // 어떤 값이 출력될까요???   },1000) }​ GO( i=0 ) for 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) for문 안의 var i는 전역변수로 호이스팅됩니다. 그리고 for문이 시작되면 0으로 할당되죠. 그 다음 곧바로 setTimeout 함수를 만나게 되죠. 문제는 setTimeout 함수는 1초가 지날 때 까지 내부 함수를 실행하지 않고 대기한다는 겁니다.   for문은 속도가 아주 빠르므로 1초보다 훨씬 짧은 시간에 다음 i로 넘어가게 되고 또 다시 setTimeout을 실행합니다. 이렇게 아주 짧은 시간에 0~3까지 4번의 setTimeout이 실행됩니다. for문이 끝났을 때의 실행컨텍스트는 아래와 같습니다. GO( i=4 ) for 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) 자, 이제 1초가 지났습니다. 3,4,5,6의 setTimeout 함수는 i 프로퍼티를 내부에 가지고 있지 않습니다. 따라서 상위에 있는 for 컨텍스트를 바라보게 되죠. for에도 i가 없으므로 GO로 갑니다. GO는 i를 4로 저장하고 있네요. 결과는 어떻게 될까요? 당연히 4를 거의 동시에 4번 출력하게 됩니다.  이제 문제를 해결해볼까요?? 중요한 점은 setTimeout 함수가 참조하는 i가 1초 후에도 변함없이 유지 되어야한다는 겁니다. for 컨텍스트는 i를 빠르게 변경하므로 i를 유지할 수가 없죠. 이것은 즉시실행함수(IIFE)를 이용하면 해결할 수 있습니다.  즉시실행함수는 함수를 선언과 동시에 실행하는 것을 말합니다. 예시를 보죠. (x => {   console.log(x) })(5)  위 결과는 5를 출력합니다. 익명함수 x => {...}를 ( )로 감싸고 곧바로 인자(5)를 넘겨주면 내부 함수가 실행되는 원리입니다. 이제 실행컨텍스트를 살펴볼까요? GO ( empty ) 즉시실행함수 컨텍스트 ( x = 5 ) console.log는 x를 참조합니다. x는 즉시실행함수에 저장되어 있네요. 즉 console.log는 5를 출력하게 됩니다.  감이 좀 오시나요? 즉시 실행함수는 새로운 컨텍스트를 만들어주고, 인자로 받은 값을 컨텍스트에 저장할 수 있습니다. 바로 이 점을 활용하는거죠.  [솔루션] 아래가 바로 정답 코드입니다. for(var i=0; i<4; i++){   (x => {     setTimeout(() => {       console.log(x)     },1000*x)   })(i) }​  1초 후의 실행컨텍스트를 살펴봅시다. GO( i=4 ) for 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=0 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=1 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=2 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=3 ) setTimeout 컨텍스트 ( empty ) 자, 어떤가요? 1초가 지난 후에 setTimeout이 실행되어도 x가 저장되어있으므로 x초마다 x를 출력할 수 있겠지요? 긴 글 읽어주셔서 감사합니다. 😍   추가) for문에서 let으로 만든 변수는 반복될 때마다 새로운 실행컨텍스트를 생성합니다. 따라서 var 변수를 let으로 변경하기만 해도 i값을 유지할 수 있답니다. ^^ 아래 코드로 간단하게 해결이 되네요! for(let i=0; i<4; i++){   setTimeout(() => {     console.log(i)   },1000*i) }​ GO( empty ) for 컨텍스트 ( i = 0) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 1) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 2) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 3) setTimeout 컨텍스트 ( empty )  참고) 같은 비동기 함수인 setInterval()을 이용하는 방법도 있어요. 취향대로 선택하셔서 사용하세요. ^^;  // setInterval() 사용 let i = 0 console.log(i++) let interval = setInterval(() => {  console.log(i++)  if(i >= 4) clearInterval(interval) }, 1000)​ " data-react-helmet="true" property="og:description"><meta content="비동기함수를 반복문에서 사용하는 방법(setTimeout, for, promise, setInterval, 실행컨텍스트)" data-react-helmet="true" name="twitter:title"><meta content="안녕하세요. 임기입니다. 😄  오늘은 자바스크립트에서 흔하게 발생하는 비동기함수를 반복문에서 사용하는 방법을 알아볼거에요.  비동기함수는 대표적으로 타임함수(setTimeout, setInterval)가 있고, fetch 등의 AJAX 함수들, 또는 Promise를 리턴하는 함수들이 있겠습니다.  그러면 반복문과 비동기 함수를 같이 사용하는 방법을 알아봅시다. 대표적인 반복문인 for로 예시를 들어볼게요. //for문 안에서 setTimeout() 함수 사용하기 for(var i=0; i<4; i++){   setTimeout(() => {    console.log(i) // 어떤 값이 출력될까요???   },1000) }​  자, for가 0~3까지 4번 실행되는 반복문을 만들고, 그 안에 setTimeout함수를 이용해서 1초 후에 i값이 콘솔에 출력되도록 하는 코드입니다. 과연 의도대로 출력이 될까요?? 만약 그랬다면 문제로 내지 않았겠죠? ㅎㅎ 저희가 원한 결과는 1초 마다 0, 1, 2, 3을 한번씩 출력하는 것입니다. 하지만 실제 결과는 1초 후에 4를 거의동시에 4번 출력하게 됩니다. 의도와 상당히 다른 결과가 나와버렸죠? 이제 이 문제를 해결해봅시다.  이 문제를 풀기 위해서는 실행컨텍스트와 스코프, 호이스팅 개념을 알고 있어야합니다. 추가적으로 클로저와 즉시실행함수, 콜스택, 이벤트루프 까지 알고 있으면 더 좋습니다. 한번에 다 다루기엔 좀 어렵죠? 😭 우선 실행컨텍스트에 대해서 알아봅시다. 자바스크립트엔진은 스크립트를 실행하다가 함수를 만나게되면 실행컨텍스트라는 것을 생성하게 되는데요. 이 실행컨텍스트에 함수가 실행될 때의 환경을 저장하게 됩니다. 이렇게 만들어진 실행컨텍스트는 자신만의 스코프(유효범위)를 갖게됩니다.예를 들어볼까요? var x = 10 var y = 20 function print(){   var x = 5   console.log(x, y) } print()  자 위의 결과는 어떻게 될까요? 어렵지 않게 5와 20이 출력된다는걸 알 수 있습니다. 그러면 실행컨텍스트 입장에서 살펴봅시다.  GO( x=10, y=20, print = function ) print 컨텍스트( x=5 ) 참조한 변수 : x=5, y=20 우선 자바스크립트가 실행되면 글로벌 오브젝트(GO)를 생성하게됩니다. GO에는 전역 변수들과 함수들이 프로퍼티로 저장되게 됩니다. 여기서는 x = 10, y = 20, print = function 정도가 저장되어 있겠네요.  자바스크립트엔진이 print() 함수를 실행하게되면 새로운 실행컨텍스트가 생성됩니다. print 컨텍스트는 x = 5를 프로퍼티로 저장합니다.  그렇다면 y는 어디서 찾을 수 있을까요? print 컨텍스트에 y라는 변수는 들어있지 않으므로 바로 상위 컨텍스트에서 y를 찾게 됩니다. 다행히 y가 GO에 저장되어 있어서 y가 20인 것을 알 수 있겠네요. 만약에 GO에도 y가 선언되어있지 않다면 'y is not defined' 라는 컨퍼런스 에러를 발생시킵니다.  즉, 변수를 참조할 땐 함수가 실행된 컨텍스트 내부를 먼저 살펴보고 없으면 상위 컨텍스트를 계속해서 찾게됩니다.   이제 for문 예시를 실행컨텍스트 입장에서 살펴봅시다. //for문 안에서 setTimeout() 함수 사용하기 for(var i=0; i<4; i++){   setTimeout(() => {    console.log(i) // 어떤 값이 출력될까요???   },1000) }​ GO( i=0 ) for 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) for문 안의 var i는 전역변수로 호이스팅됩니다. 그리고 for문이 시작되면 0으로 할당되죠. 그 다음 곧바로 setTimeout 함수를 만나게 되죠. 문제는 setTimeout 함수는 1초가 지날 때 까지 내부 함수를 실행하지 않고 대기한다는 겁니다.   for문은 속도가 아주 빠르므로 1초보다 훨씬 짧은 시간에 다음 i로 넘어가게 되고 또 다시 setTimeout을 실행합니다. 이렇게 아주 짧은 시간에 0~3까지 4번의 setTimeout이 실행됩니다. for문이 끝났을 때의 실행컨텍스트는 아래와 같습니다. GO( i=4 ) for 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) 자, 이제 1초가 지났습니다. 3,4,5,6의 setTimeout 함수는 i 프로퍼티를 내부에 가지고 있지 않습니다. 따라서 상위에 있는 for 컨텍스트를 바라보게 되죠. for에도 i가 없으므로 GO로 갑니다. GO는 i를 4로 저장하고 있네요. 결과는 어떻게 될까요? 당연히 4를 거의 동시에 4번 출력하게 됩니다.  이제 문제를 해결해볼까요?? 중요한 점은 setTimeout 함수가 참조하는 i가 1초 후에도 변함없이 유지 되어야한다는 겁니다. for 컨텍스트는 i를 빠르게 변경하므로 i를 유지할 수가 없죠. 이것은 즉시실행함수(IIFE)를 이용하면 해결할 수 있습니다.  즉시실행함수는 함수를 선언과 동시에 실행하는 것을 말합니다. 예시를 보죠. (x => {   console.log(x) })(5)  위 결과는 5를 출력합니다. 익명함수 x => {...}를 ( )로 감싸고 곧바로 인자(5)를 넘겨주면 내부 함수가 실행되는 원리입니다. 이제 실행컨텍스트를 살펴볼까요? GO ( empty ) 즉시실행함수 컨텍스트 ( x = 5 ) console.log는 x를 참조합니다. x는 즉시실행함수에 저장되어 있네요. 즉 console.log는 5를 출력하게 됩니다.  감이 좀 오시나요? 즉시 실행함수는 새로운 컨텍스트를 만들어주고, 인자로 받은 값을 컨텍스트에 저장할 수 있습니다. 바로 이 점을 활용하는거죠.  [솔루션] 아래가 바로 정답 코드입니다. for(var i=0; i<4; i++){   (x => {     setTimeout(() => {       console.log(x)     },1000*x)   })(i) }​  1초 후의 실행컨텍스트를 살펴봅시다. GO( i=4 ) for 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=0 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=1 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=2 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=3 ) setTimeout 컨텍스트 ( empty ) 자, 어떤가요? 1초가 지난 후에 setTimeout이 실행되어도 x가 저장되어있으므로 x초마다 x를 출력할 수 있겠지요? 긴 글 읽어주셔서 감사합니다. 😍   추가) for문에서 let으로 만든 변수는 반복될 때마다 새로운 실행컨텍스트를 생성합니다. 따라서 var 변수를 let으로 변경하기만 해도 i값을 유지할 수 있답니다. ^^ 아래 코드로 간단하게 해결이 되네요! for(let i=0; i<4; i++){   setTimeout(() => {     console.log(i)   },1000*i) }​ GO( empty ) for 컨텍스트 ( i = 0) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 1) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 2) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 3) setTimeout 컨텍스트 ( empty )  참고) 같은 비동기 함수인 setInterval()을 이용하는 방법도 있어요. 취향대로 선택하셔서 사용하세요. ^^;  // setInterval() 사용 let i = 0 console.log(i++) let interval = setInterval(() => {  console.log(i++)  if(i >= 4) clearInterval(interval) }, 1000)​ " data-react-helmet="true" name="twitter:description"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><input class="hidden" id="userinfo"><div class="hidden" id="naverIdLogin"><a href="#" id="naverIdLogin_loginButton"><img src="https://static.nid.naver.com/oauth/big_g.PNG?version=js-2.0.0" height="60"></a></div><div class="hidden" id="naverIdLogout" onclick="naverIdLogout()"></div><script type="text/javascript">let callBackUrl;callBackUrl=window.location.href.indexOf("localhost")>-1?"http://localhost:3000/login":"https://imki123.github.io/login";var naverLogin=new naver.LoginWithNaverId({clientId:"kjVk1u480gzQO_XLX_hp",callbackUrl:callBackUrl,isPopup:!1,loginButton:{color:"green",type:3,height:60}});function naverIdLogout(){naverLogin.logout();const n=window.open("https://nid.naver.com/nidlogin.logout");setTimeout((function(){n.close()}),1)}naverLogin.init(),window.addEventListener("load",(function(){naverLogin.getLoginStatus((function(n){if(n){let n=naverLogin.user;n.host="naver";const o=document.querySelector("#userinfo");o&&(o.value=JSON.stringify(n))}}))}))</script><div class="hidden" id="kakaoLogin" onclick="kakaoLogin()"></div><div class="hidden" id="kakaoLogout" onclick="kakaoLogout()"></div><script>function kakaoLogin(){Kakao.Auth.login({success:function(o){Kakao.API.request({url:"/v2/user/me",success:function(o){let a=o.kakao_account;a.host="kakao";const n=document.querySelector("#userinfo");n&&(n.value=JSON.stringify(a))},fail:function(o){}})},fail:function(o){}})}function kakaoLogout(){Kakao.Auth.getAccessToken()&&(Kakao.API.request({url:"/v1/user/unlink",success:function(o){},fail:function(o){console.log(o)}}),Kakao.Auth.setAccessToken(void 0))}Kakao.init("0d74caaceac5f0f14c0d6a667a9dbdee")</script><div id="googleLogin"></div><div id="googleLogout" onclick="signOut()"></div><script>if("ReactSnap"!==navigator.userAgent){let e=document.createElement("script");e.setAttribute("src","https://apis.google.com/js/platform.js"),e.setAttribute("async",!0),e.setAttribute("defer",!0),document.body.appendChild(e);let t=document.querySelector("#googleLogin");t&&(t.innerHTML='<div class="g-signin2 hidden" data-onsuccess="onSignIn" data-theme="dark"></div>')}</script><script>function onSignIn(e){var t=e.getBasicProfile();let n={name:t.getName(),email:t.getEmail(),imageUrl:t.getImageUrl(),host:"google"};const i=document.querySelector("#userinfo");i&&(i.value=JSON.stringify(n));e.getAuthResponse().id_token}function signOut(){var e=gapi.auth2.getAuthInstance();e.signOut().then((function(){})),e.disconnect().then(()=>{})}</script><div id="root"><div id="app"><div id="headerWrapper"><div id="header"><div class="menu hover"><svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></div><a href="/"><div class="hover" id="title"><img src="/images/imcat_64.png" alt="logo" id="logo">임기의 코딩 블로그</div></a><div class="hover"><img src="/images/noavatar.png" alt="PROFILE" class="profile"></div></div></div><div id="settingWrapper"><div id="setting"><div id="settingListWrapper"><a href="/login" class="settingList">로그인</a><a href="/register" class="settingList">회원가입</a></div></div></div><div id="body"><div id="guideBack"></div><div class="slideMenu" id="guideWrapper"><div id="avatar"><img src="/images/avatar.png" alt="avatar" title="Hello 😄"><div id="name">Im kiyoung</div><div id="nickName">imki123</div><div id="github"><a href="https://github.com/imki123"><img src="/images/GitHub-Mark-32px.png" alt="github"> <span>https://github.com/imki123</span></a></div><div id="introduction">A web programmer who dreams of becoming a wise developer.</div></div><div class="menus"><div><a href="/" class="list"><span class="menuName">Home</span><span class="menuOptions"><span class="menuCnt">1</span><span class="menuExpandIcon"></span></span></a></div><div><a href="/tags/programming" class="list"><span class="menuName">Programming</span><span class="menuOptions"><span class="menuCnt">12</span><span class="menuExpandIcon"><svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></span></span></a><a href="/tags/css" class="list subList"><span class="menuName">Css</span><span class="menuOptions"><span class="menuCnt">2</span></span></a><a href="/tags/github" class="list subList"><span class="menuName">Github</span><span class="menuOptions"><span class="menuCnt">1</span></span></a><a href="/tags/javascript" class="list subList activeListManual"><span class="menuName">Javascript</span><span class="menuOptions"><span class="menuCnt">4</span></span></a><a href="/tags/koa" class="list subList"><span class="menuName">Koa</span><span class="menuOptions"><span class="menuCnt">2</span></span></a><a href="/tags/react" class="list subList"><span class="menuName">React</span><span class="menuOptions"><span class="menuCnt">2</span></span></a><a href="/tags/react-native" class="list subList"><span class="menuName">React-native</span><span class="menuOptions"><span class="menuCnt">1</span></span></a></div><div><a href="/tags/article" class="list"><span class="menuName">Article</span><span class="menuOptions"><span class="menuCnt">3</span><span class="menuExpandIcon"><svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></span></span></a><a href="/tags/current" class="list subList"><span class="menuName">Current</span><span class="menuOptions"><span class="menuCnt">2</span></span></a><a href="/tags/play" class="list subList"><span class="menuName">Play</span><span class="menuOptions"><span class="menuCnt">1</span></span></a></div></div><div class="menus"><a href="https://imki123.github.io/catbook" class="list"><div class="menuLink"><div><img src="/images/catbook_64.png" alt="catbook">Catbook</div><svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></div></a><a href="https://imki123.github.io/onandoff" class="list"><div class="menuLink"><div><img src="/images/imcat_64.png" alt="onandoff">OnAndOff</div><svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></div></a></div></div><div class="slideMenu" id="content"><div class="hover FAB" id="scrollFAB"><svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"></path></svg></div><div class="hover FAB" id="backFAB"><svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg></div><div class="hover FAB" id="menuFAB"><svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></div><div id="loading" style="display:none"><img src="/images/loading.gif" alt="Loading"></div><div class="post" style="display:block"><div class="nav"><div><span>Tag : </span><span><a href="/tags/programming">programming</a></span><span>, <a href="/tags/javascript" class="activeListManual">javascript</a></span></div><div><span>조회수: 137, </span>2020-11-09 03:03</div></div><h2 class="postTitle">비동기함수를 반복문에서 사용하는 방법(setTimeout, for, promise, setInterval, 실행컨텍스트)</h2><div class="postContent"><div id="editor"><div class="ql-toolbar ql-snow"><span class="ql-formats"><button class="ql-bold" type="button"><svg viewBox="0 0 18 18"><path d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z" class="ql-stroke"></path><path d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z" class="ql-stroke"></path></svg></button><button class="ql-italic" type="button"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"></line><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"></line><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"></line></svg></button><button class="ql-underline" type="button"><svg viewBox="0 0 18 18"><path d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3" class="ql-stroke"></path><rect height="1" width="12" x="3" y="15" class="ql-fill" rx="0.5" ry="0.5"></rect></svg></button><button class="ql-strike" type="button"><svg viewBox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"></line><path d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z" class="ql-fill"></path><path d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z" class="ql-fill"></path></svg></button></span><span class="ql-formats"><span class="ql-align ql-picker ql-icon-picker"><span class="ql-picker-label" tabindex="0" role="button" aria-controls="ql-picker-options-0" aria-expanded="false"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"></line><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"></line><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"></line></svg></span><span class="ql-picker-options" tabindex="-1" aria-hidden="true" id="ql-picker-options-0"><span class="ql-picker-item" tabindex="0" role="button"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"></line><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"></line><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"></line></svg></span><span class="ql-picker-item" tabindex="0" role="button" data-value="center"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"></line><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"></line></svg></span><span class="ql-picker-item" tabindex="0" role="button" data-value="right"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"></line><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"></line></svg></span><span class="ql-picker-item" tabindex="0" role="button" data-value="justify"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"></line><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"></line></svg></span></span></span><select class="ql-align" style="display:none"><option></option><option value="center"></option><option value="right"></option><option value="justify"></option></select></span><span class="ql-formats"><button class="ql-list" type="button" value="ordered"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"></line><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"></line><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"></line><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"></line><path d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z" class="ql-fill"></path><path d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156" class="ql-stroke ql-thin"></path><path d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109" class="ql-stroke ql-thin"></path></svg></button><button class="ql-list" type="button" value="bullet"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"></line><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"></line><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"></line><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"></line><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"></line><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"></line></svg></button></span><span class="ql-formats"><button class="ql-indent" type="button" value="-1"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"></line><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"></line><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"></line><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"></polyline></svg></button><button class="ql-indent" type="button" value="+1"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"></line><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"></line><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"></line><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline></svg></button></span><span class="ql-formats"><span class="ql-size ql-picker"><span class="ql-picker-label" tabindex="0" role="button" aria-controls="ql-picker-options-1" aria-expanded="false"><svg viewBox="0 0 18 18"><polygon points="7 11 9 13 11 11 7 11" class="ql-stroke"></polygon><polygon points="7 7 9 5 11 7 7 7" class="ql-stroke"></polygon></svg></span><span class="ql-picker-options" tabindex="-1" aria-hidden="true" id="ql-picker-options-1"><span class="ql-picker-item" tabindex="0" role="button" data-value="small"></span><span class="ql-picker-item" tabindex="0" role="button"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="large"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="huge"></span></span></span><select class="ql-size" style="display:none"><option value="small"></option><option></option><option value="large"></option><option value="huge"></option></select></span><span class="ql-formats"><span class="ql-header ql-picker"><span class="ql-picker-label" tabindex="0" role="button" aria-controls="ql-picker-options-2" aria-expanded="false"><svg viewBox="0 0 18 18"><polygon points="7 11 9 13 11 11 7 11" class="ql-stroke"></polygon><polygon points="7 7 9 5 11 7 7 7" class="ql-stroke"></polygon></svg></span><span class="ql-picker-options" tabindex="-1" aria-hidden="true" id="ql-picker-options-2"><span class="ql-picker-item" tabindex="0" role="button" data-value="1"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="2"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="3"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="4"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="5"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="6"></span><span class="ql-picker-item" tabindex="0" role="button"></span></span></span><select class="ql-header" style="display:none"><option value="1"></option><option value="2"></option><option value="3"></option><option value="4"></option><option value="5"></option><option value="6"></option><option></option></select></span><span class="ql-formats"><button class="ql-link" type="button"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"></line><path d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z" class="ql-even ql-stroke"></path><path d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z" class="ql-even ql-stroke"></path></svg></button><button class="ql-image" type="button"><svg viewBox="0 0 18 18"><rect height="10" width="12" x="3" y="4" class="ql-stroke"></rect><circle class="ql-fill" cx="6" cy="7" r="1"></circle><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline></svg></button><button class="ql-video" type="button"><svg viewBox="0 0 18 18"><rect height="12" width="12" x="3" y="3" class="ql-stroke"></rect><rect height="12" width="1" x="5" y="3" class="ql-fill"></rect><rect height="12" width="1" x="12" y="3" class="ql-fill"></rect><rect height="2" width="8" x="5" y="8" class="ql-fill"></rect><rect height="1" width="3" x="3" y="5" class="ql-fill"></rect><rect height="1" width="3" x="3" y="7" class="ql-fill"></rect><rect height="1" width="3" x="3" y="10" class="ql-fill"></rect><rect height="1" width="3" x="3" y="12" class="ql-fill"></rect><rect height="1" width="3" x="12" y="5" class="ql-fill"></rect><rect height="1" width="3" x="12" y="7" class="ql-fill"></rect><rect height="1" width="3" x="12" y="10" class="ql-fill"></rect><rect height="1" width="3" x="12" y="12" class="ql-fill"></rect></svg></button></span><span class="ql-formats"><span class="ql-color ql-picker ql-color-picker"><span class="ql-picker-label" tabindex="0" role="button" aria-controls="ql-picker-options-3" aria-expanded="false"><svg viewBox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"></line><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"></polyline><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"></line></svg></span><span class="ql-picker-options" tabindex="-1" aria-hidden="true" id="ql-picker-options-3"><span class="ql-picker-item ql-primary" tabindex="0" role="button"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#e60000" style="background-color:#e60000"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#ff9900" style="background-color:#f90"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#ffff00" style="background-color:#ff0"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#008a00" style="background-color:#008a00"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#0066cc" style="background-color:#06c"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#9933ff" style="background-color:#93f"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffffff" style="background-color:#fff"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#facccc" style="background-color:#facccc"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffebcc" style="background-color:#ffebcc"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffffcc" style="background-color:#ffc"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#cce8cc" style="background-color:#cce8cc"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#cce0f5" style="background-color:#cce0f5"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ebd6ff" style="background-color:#ebd6ff"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#bbbbbb" style="background-color:#bbb"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#f06666" style="background-color:#f06666"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffc266" style="background-color:#ffc266"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffff66" style="background-color:#ff6"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#66b966" style="background-color:#66b966"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#66a3e0" style="background-color:#66a3e0"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#c285ff" style="background-color:#c285ff"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#888888" style="background-color:#888"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#a10000" style="background-color:#a10000"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#b26b00" style="background-color:#b26b00"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#b2b200" style="background-color:#b2b200"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#006100" style="background-color:#006100"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#0047b2" style="background-color:#0047b2"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#6b24b2" style="background-color:#6b24b2"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#444444" style="background-color:#444"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#5c0000" style="background-color:#5c0000"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#663d00" style="background-color:#663d00"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#666600" style="background-color:#660"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#003700" style="background-color:#003700"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#002966" style="background-color:#002966"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#3d1466" style="background-color:#3d1466"></span></span></span><select class="ql-color" style="display:none"><option></option><option value="#e60000"></option><option value="#ff9900"></option><option value="#ffff00"></option><option value="#008a00"></option><option value="#0066cc"></option><option value="#9933ff"></option><option value="#ffffff"></option><option value="#facccc"></option><option value="#ffebcc"></option><option value="#ffffcc"></option><option value="#cce8cc"></option><option value="#cce0f5"></option><option value="#ebd6ff"></option><option value="#bbbbbb"></option><option value="#f06666"></option><option value="#ffc266"></option><option value="#ffff66"></option><option value="#66b966"></option><option value="#66a3e0"></option><option value="#c285ff"></option><option value="#888888"></option><option value="#a10000"></option><option value="#b26b00"></option><option value="#b2b200"></option><option value="#006100"></option><option value="#0047b2"></option><option value="#6b24b2"></option><option value="#444444"></option><option value="#5c0000"></option><option value="#663d00"></option><option value="#666600"></option><option value="#003700"></option><option value="#002966"></option><option value="#3d1466"></option></select><span class="ql-background ql-picker ql-color-picker"><span class="ql-picker-label" tabindex="0" role="button" aria-controls="ql-picker-options-4" aria-expanded="false"><svg viewBox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon><rect height="1" width="1" x="4" y="4"></rect><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon><rect height="1" width="1" x="2" y="6"></rect><rect height="1" width="1" x="3" y="5"></rect><rect height="1" width="1" x="4" y="7"></rect><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon><rect height="1" width="1" x="2" y="12"></rect><rect height="1" width="1" x="2" y="9"></rect><rect height="1" width="1" x="2" y="15"></rect><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon><rect height="1" width="1" x="3" y="8"></rect><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"></path><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"></path><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"></path><rect height="1" width="1" x="12" y="2"></rect><rect height="1" width="1" x="11" y="3"></rect><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"></path><rect height="1" width="1" x="2" y="3"></rect><rect height="1" width="1" x="6" y="2"></rect><rect height="1" width="1" x="3" y="2"></rect><rect height="1" width="1" x="5" y="3"></rect><rect height="1" width="1" x="9" y="2"></rect><rect height="1" width="1" x="15" y="14"></rect><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon><rect height="1" width="1" x="13" y="7"></rect><rect height="1" width="1" x="15" y="5"></rect><rect height="1" width="1" x="14" y="6"></rect><rect height="1" width="1" x="15" y="8"></rect><rect height="1" width="1" x="14" y="9"></rect><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"></path><rect height="1" width="1" x="14" y="3"></rect><polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon><rect height="1" width="1" x="15" y="2"></rect><rect height="1" width="1" x="12" y="5"></rect><rect height="1" width="1" x="13" y="4"></rect><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon><rect height="1" width="1" x="9" y="14"></rect><rect height="1" width="1" x="8" y="15"></rect><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"></path><rect height="1" width="1" x="5" y="15"></rect><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"></path><rect height="1" width="1" x="11" y="15"></rect><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"></path><rect height="1" width="1" x="14" y="15"></rect><rect height="1" width="1" x="15" y="11"></rect></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"></polyline><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"></line></svg></span><span class="ql-picker-options" tabindex="-1" aria-hidden="true" id="ql-picker-options-4"><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#000000" style="background-color:#000"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#e60000" style="background-color:#e60000"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#ff9900" style="background-color:#f90"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#ffff00" style="background-color:#ff0"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#008a00" style="background-color:#008a00"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#0066cc" style="background-color:#06c"></span><span class="ql-picker-item ql-primary" tabindex="0" role="button" data-value="#9933ff" style="background-color:#93f"></span><span class="ql-picker-item" tabindex="0" role="button"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#facccc" style="background-color:#facccc"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffebcc" style="background-color:#ffebcc"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffffcc" style="background-color:#ffc"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#cce8cc" style="background-color:#cce8cc"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#cce0f5" style="background-color:#cce0f5"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ebd6ff" style="background-color:#ebd6ff"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#bbbbbb" style="background-color:#bbb"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#f06666" style="background-color:#f06666"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffc266" style="background-color:#ffc266"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#ffff66" style="background-color:#ff6"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#66b966" style="background-color:#66b966"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#66a3e0" style="background-color:#66a3e0"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#c285ff" style="background-color:#c285ff"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#888888" style="background-color:#888"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#a10000" style="background-color:#a10000"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#b26b00" style="background-color:#b26b00"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#b2b200" style="background-color:#b2b200"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#006100" style="background-color:#006100"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#0047b2" style="background-color:#0047b2"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#6b24b2" style="background-color:#6b24b2"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#444444" style="background-color:#444"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#5c0000" style="background-color:#5c0000"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#663d00" style="background-color:#663d00"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#666600" style="background-color:#660"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#003700" style="background-color:#003700"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#002966" style="background-color:#002966"></span><span class="ql-picker-item" tabindex="0" role="button" data-value="#3d1466" style="background-color:#3d1466"></span></span></span><select class="ql-background" style="display:none"><option value="#000000"></option><option value="#e60000"></option><option value="#ff9900"></option><option value="#ffff00"></option><option value="#008a00"></option><option value="#0066cc"></option><option value="#9933ff"></option><option></option><option value="#facccc"></option><option value="#ffebcc"></option><option value="#ffffcc"></option><option value="#cce8cc"></option><option value="#cce0f5"></option><option value="#ebd6ff"></option><option value="#bbbbbb"></option><option value="#f06666"></option><option value="#ffc266"></option><option value="#ffff66"></option><option value="#66b966"></option><option value="#66a3e0"></option><option value="#c285ff"></option><option value="#888888"></option><option value="#a10000"></option><option value="#b26b00"></option><option value="#b2b200"></option><option value="#006100"></option><option value="#0047b2"></option><option value="#6b24b2"></option><option value="#444444"></option><option value="#5c0000"></option><option value="#663d00"></option><option value="#666600"></option><option value="#003700"></option><option value="#002966"></option><option value="#3d1466"></option></select></span><span class="ql-formats"><button class="ql-clean" type="button"><svg viewBox="0 0 18 18" class=""><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"></line><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"></line><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"></line><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"></line><rect height="1" width="7" x="2" y="14" class="ql-fill" rx="0.5" ry="0.5"></rect></svg></button></span></div><div class="ql-toolbar ql-snow ql-container ql-disabled"><div class="ql-editor" contenteditable="false" data-gramm="false"><p>안녕하세요. 임기입니다. 😄</p><p>오늘은 자바스크립트에서 흔하게 발생하는 <strong>비동기함수</strong>를 <strong>반복문</strong>에서 사용하는 방법을 알아볼거에요.</p><p><br></p><p>비동기함수는 대표적으로 타임함수(setTimeout, setInterval)가 있고, fetch 등의 AJAX 함수들, 또는 Promise를 리턴하는 함수들이 있겠습니다.</p><p><br></p><p>그러면 반복문과 비동기 함수를 같이 사용하는 방법을 알아봅시다.</p><p>대표적인 반복문인 for로 예시를 들어볼게요.</p><pre class="ql-syntax" spellcheck="false"><span class="hljs-comment">//for문 안에서 setTimeout() 함수 사용하기</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++){
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
   <span class="hljs-built_in">console</span>.log(i) <span class="hljs-comment">// 어떤 값이 출력될까요???</span>
  },<span class="hljs-number">1000</span>)
}​
</pre><p><br></p><p>자, for가 0~3까지 4번 실행되는 반복문을 만들고, 그 안에 setTimeout함수를 이용해서 1초 후에 i값이 콘솔에 출력되도록 하는 코드입니다.</p><p>과연 의도대로 출력이 될까요?? 만약 그랬다면 문제로 내지 않았겠죠? ㅎㅎ</p><p>저희가 원한 결과는 <strong>1초 마다 0, 1, 2, 3을 한번씩 출력</strong>하는 것입니다.</p><p>하지만 실제 결과는 <strong>1초 후에 4를 거의동시에 4번 출력</strong>하게 됩니다.</p><p>의도와 상당히 다른 결과가 나와버렸죠? 이제 이 문제를 해결해봅시다.</p><p><br></p><p>이 문제를 풀기 위해서는 <strong>실행컨텍스트</strong>와 <strong>스코프, 호이스팅</strong> 개념을 알고 있어야합니다. 추가적으로 클로저와 즉시실행함수, 콜스택, 이벤트루프 까지 알고 있으면 더 좋습니다. 한번에 다 다루기엔 좀 어렵죠? 😭</p><p>우선 <strong>실행컨텍스트</strong>에 대해서 알아봅시다. 자바스크립트엔진은 스크립트를 실행하다가 함수를 만나게되면 실행컨텍스트라는 것을 생성하게 되는데요. 이 실행컨텍스트에 함수가 실행될 때의 환경을 저장하게 됩니다. 이렇게 만들어진 실행컨텍스트는 자신만의 <strong>스코프</strong>(유효범위)를 갖게됩니다.예를 들어볼까요?</p><pre class="ql-syntax" spellcheck="false"><span class="hljs-keyword">var</span> x = <span class="hljs-number">10</span>
<span class="hljs-keyword">var</span> y = <span class="hljs-number">20</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">print</span>()</span>{
  <span class="hljs-keyword">var</span> x = <span class="hljs-number">5</span>
  <span class="hljs-built_in">console</span>.log(x, y)
}
print()
</pre><p><br></p><p>자 위의 결과는 어떻게 될까요? 어렵지 않게 5와 20이 출력된다는걸 알 수 있습니다.</p><p>그러면 <strong>실행컨텍스트</strong> 입장에서 살펴봅시다.</p><ol><li>GO( x=10, y=20, print = function )</li><li>print 컨텍스트( x=5 )</li><li>참조한 변수 : x=5, y=20</li></ol><p>우선 자바스크립트가 실행되면 글로벌 오브젝트(GO)를 생성하게됩니다. GO에는 전역 변수들과 함수들이 프로퍼티로 저장되게 됩니다. 여기서는 x = 10, y = 20, print = function 정도가 저장되어 있겠네요.</p><p>자바스크립트엔진이 print() 함수를 실행하게되면 새로운 실행컨텍스트가 생성됩니다. print 컨텍스트는 x = 5를 프로퍼티로 저장합니다.</p><p>그렇다면 y는 어디서 찾을 수 있을까요? print 컨텍스트에 y라는 변수는 들어있지 않으므로 바로 상위 컨텍스트에서 y를 찾게 됩니다. 다행히 y가 GO에 저장되어 있어서 y가 20인 것을 알 수 있겠네요. 만약에 GO에도 y가 선언되어있지 않다면 'y is not defined' 라는 컨퍼런스 에러를 발생시킵니다.</p><p>즉, 변수를 참조할 땐 함수가 실행된 컨텍스트 내부를 먼저 살펴보고 없으면 상위 컨텍스트를 계속해서 찾게됩니다.</p><p><br></p><p>이제 for문 예시를 실행컨텍스트 입장에서 살펴봅시다.</p><pre class="ql-syntax" spellcheck="false"><span class="hljs-comment">//for문 안에서 setTimeout() 함수 사용하기</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++){
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
   <span class="hljs-built_in">console</span>.log(i) <span class="hljs-comment">// 어떤 값이 출력될까요???</span>
  },<span class="hljs-number">1000</span>)
}​
</pre><ol><li>GO( i=0 )</li><li>for 컨텍스트 ( empty )</li><li>setTimeout 컨텍스트 ( empty )</li></ol><p>for문 안의 var i는 전역변수로 호이스팅됩니다. 그리고 for문이 시작되면 0으로 할당되죠. 그 다음 곧바로 setTimeout 함수를 만나게 되죠. 문제는 setTimeout 함수는 1초가 지날 때 까지 내부 함수를 실행하지 않고 대기한다는 겁니다.</p><p>for문은 속도가 아주 빠르므로 1초보다 훨씬 짧은 시간에 다음 i로 넘어가게 되고 또 다시 setTimeout을 실행합니다. 이렇게 아주 짧은 시간에 0~3까지 4번의 setTimeout이 실행됩니다.</p><p>for문이 끝났을 때의 실행컨텍스트는 아래와 같습니다.</p><ol><li>GO( i=4 )</li><li>for 컨텍스트 ( empty )</li><li>setTimeout 컨텍스트 ( empty )</li><li>setTimeout 컨텍스트 ( empty )</li><li>setTimeout 컨텍스트 ( empty )</li><li>setTimeout 컨텍스트 ( empty )</li></ol><p>자, 이제 1초가 지났습니다. 3,4,5,6의 setTimeout 함수는 i 프로퍼티를 내부에 가지고 있지 않습니다. 따라서 상위에 있는 for 컨텍스트를 바라보게 되죠. for에도 i가 없으므로 GO로 갑니다. GO는 i를 4로 저장하고 있네요. 결과는 어떻게 될까요? 당연히 4를 거의 동시에 4번 출력하게 됩니다.</p><p><br></p><p>이제 문제를 해결해볼까요??</p><p>중요한 점은 setTimeout 함수가 참조하는 i가 1초 후에도 변함없이 유지 되어야한다는 겁니다. for 컨텍스트는 i를 빠르게 변경하므로 i를 유지할 수가 없죠. 이것은 즉시실행함수(IIFE)를 이용하면 해결할 수 있습니다.</p><p>즉시실행함수는 함수를 선언과 동시에 실행하는 것을 말합니다. 예시를 보죠.</p><pre class="ql-syntax" spellcheck="false">(<span class="hljs-function"><span class="hljs-params">x</span> =></span> {
  <span class="hljs-built_in">console</span>.log(x)
})(<span class="hljs-number">5</span>)
</pre><p><br></p><p>위 결과는 5를 출력합니다. 익명함수 x => {...}를 ( )로 감싸고 곧바로 인자(5)를 넘겨주면 내부 함수가 실행되는 원리입니다. 이제 실행컨텍스트를 살펴볼까요?</p><ol><li>GO ( empty )</li><li>즉시실행함수 컨텍스트 ( x = 5 )</li></ol><p>console.log는 x를 참조합니다. x는 즉시실행함수에 저장되어 있네요. 즉 console.log는 5를 출력하게 됩니다.</p><p>감이 좀 오시나요? 즉시 실행함수는 새로운 컨텍스트를 만들어주고, 인자로 받은 값을 컨텍스트에 저장할 수 있습니다. 바로 이 점을 활용하는거죠.</p><p><br></p><p><strong>[솔루션] </strong>아래가 바로 정답 코드입니다.</p><pre class="ql-syntax" spellcheck="false"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++){
  (<span class="hljs-function"><span class="hljs-params">x</span> =></span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
      <span class="hljs-built_in">console</span>.log(x)
    },<span class="hljs-number">1000</span>*x)
  })(i)
}​
</pre><p><br></p><p>1초 후의 실행컨텍스트를 살펴봅시다.</p><ol><li>GO( i=4 )</li><li>for 컨텍스트 ( empty )</li><li>즉시실행함수 컨텍스트 ( x=0 )</li><li>setTimeout 컨텍스트 ( empty )</li><li>즉시실행함수 컨텍스트 ( x=1 )</li><li>setTimeout 컨텍스트 ( empty )</li><li>즉시실행함수 컨텍스트 ( x=2 )</li><li>setTimeout 컨텍스트 ( empty )</li><li>즉시실행함수 컨텍스트 ( x=3 )</li><li>setTimeout 컨텍스트 ( empty )</li></ol><p>자, 어떤가요? 1초가 지난 후에 setTimeout이 실행되어도 x가 저장되어있으므로 x초마다 x를 출력할 수 있겠지요?</p><p>긴 글 읽어주셔서 감사합니다. 😍</p><p><br></p><p><br></p><p>추가) for문에서 let으로 만든 변수는 반복될 때마다 새로운 실행컨텍스트를 생성합니다. 따라서 var 변수를 let으로 변경하기만 해도 i값을 유지할 수 있답니다. ^^ 아래 코드로 간단하게 해결이 되네요!</p><pre class="ql-syntax" spellcheck="false"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++){
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
    <span class="hljs-built_in">console</span>.log(i)
  },<span class="hljs-number">1000</span>*i)
}​
</pre><ol><li>GO( empty )</li><li>for 컨텍스트 ( i = 0)</li><li>setTimeout 컨텍스트 ( empty )</li><li>for 컨텍스트 ( i = 1)</li><li>setTimeout 컨텍스트 ( empty )</li><li>for 컨텍스트 ( i = 2)</li><li>setTimeout 컨텍스트 ( empty )</li><li>for 컨텍스트 ( i = 3)</li><li>setTimeout 컨텍스트 ( empty )</li></ol><p><br></p><p>참고) 같은 비동기 함수인 setInterval()을 이용하는 방법도 있어요. 취향대로 선택하셔서 사용하세요. ^^;</p><pre class="ql-syntax" spellcheck="false"><span class="hljs-comment">// setInterval() 사용</span>
<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>
<span class="hljs-built_in">console</span>.log(i++)
<span class="hljs-keyword">let</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =></span> {
 <span class="hljs-built_in">console</span>.log(i++)
 <span class="hljs-keyword">if</span>(i >= <span class="hljs-number">4</span>) <span class="hljs-built_in">clearInterval</span>(interval)
}, <span class="hljs-number">1000</span>)​
</pre></div><div class="ql-clipboard" contenteditable="true" tabindex="-1"></div><div class="ql-tooltip ql-hidden"><a href="about:blank" class="ql-preview" rel="noopener noreferrer" target="_blank"></a><input data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL" type="text"><a class="ql-action"></a><a class="ql-remove"></a></div></div></div><div class="hiddenText">안녕하세요. 임기입니다. 😄 오늘은 자바스크립트에서 흔하게 발생하는 비동기함수를 반복문에서 사용하는 방법을 알아볼거에요. 비동기함수는 대표적으로 타임함수(setTimeout, setInterval)가 있고, fetch 등의 AJAX 함수들, 또는 Promise를 리턴하는 함수들이 있겠습니다. 그러면 반복문과 비동기 함수를 같이 사용하는 방법을 알아봅시다. 대표적인 반복문인 for로 예시를 들어볼게요. //for문 안에서 setTimeout() 함수 사용하기 for(var i=0; i&lt;4; i++){   setTimeout(() => {    console.log(i) // 어떤 값이 출력될까요???   },1000) }​ 자, for가 0~3까지 4번 실행되는 반복문을 만들고, 그 안에 setTimeout함수를 이용해서 1초 후에 i값이 콘솔에 출력되도록 하는 코드입니다. 과연 의도대로 출력이 될까요?? 만약 그랬다면 문제로 내지 않았겠죠? ㅎㅎ 저희가 원한 결과는 1초 마다 0, 1, 2, 3을 한번씩 출력하는 것입니다. 하지만 실제 결과는 1초 후에 4를 거의동시에 4번 출력하게 됩니다. 의도와 상당히 다른 결과가 나와버렸죠? 이제 이 문제를 해결해봅시다. 이 문제를 풀기 위해서는 실행컨텍스트와 스코프, 호이스팅 개념을 알고 있어야합니다. 추가적으로 클로저와 즉시실행함수, 콜스택, 이벤트루프 까지 알고 있으면 더 좋습니다. 한번에 다 다루기엔 좀 어렵죠? 😭 우선 실행컨텍스트에 대해서 알아봅시다. 자바스크립트엔진은 스크립트를 실행하다가 함수를 만나게되면 실행컨텍스트라는 것을 생성하게 되는데요. 이 실행컨텍스트에 함수가 실행될 때의 환경을 저장하게 됩니다. 이렇게 만들어진 실행컨텍스트는 자신만의 스코프(유효범위)를 갖게됩니다.예를 들어볼까요? var x = 10 var y = 20 function print(){ var x = 5 console.log(x, y) } print() 자 위의 결과는 어떻게 될까요? 어렵지 않게 5와 20이 출력된다는걸 알 수 있습니다. 그러면 실행컨텍스트 입장에서 살펴봅시다. GO( x=10, y=20, print = function ) print 컨텍스트( x=5 ) 참조한 변수 : x=5, y=20 우선 자바스크립트가 실행되면 글로벌 오브젝트(GO)를 생성하게됩니다. GO에는 전역 변수들과 함수들이 프로퍼티로 저장되게 됩니다. 여기서는 x = 10, y = 20, print = function 정도가 저장되어 있겠네요. 자바스크립트엔진이 print() 함수를 실행하게되면 새로운 실행컨텍스트가 생성됩니다. print 컨텍스트는 x = 5를 프로퍼티로 저장합니다. 그렇다면 y는 어디서 찾을 수 있을까요? print 컨텍스트에 y라는 변수는 들어있지 않으므로 바로 상위 컨텍스트에서 y를 찾게 됩니다. 다행히 y가 GO에 저장되어 있어서 y가 20인 것을 알 수 있겠네요. 만약에 GO에도 y가 선언되어있지 않다면 'y is not defined' 라는 컨퍼런스 에러를 발생시킵니다. 즉, 변수를 참조할 땐 함수가 실행된 컨텍스트 내부를 먼저 살펴보고 없으면 상위 컨텍스트를 계속해서 찾게됩니다. 이제 for문 예시를 실행컨텍스트 입장에서 살펴봅시다. //for문 안에서 setTimeout() 함수 사용하기 for(var i=0; i&lt;4; i++){   setTimeout(() => {    console.log(i) // 어떤 값이 출력될까요???   },1000) }​ GO( i=0 ) for 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) for문 안의 var i는 전역변수로 호이스팅됩니다. 그리고 for문이 시작되면 0으로 할당되죠. 그 다음 곧바로 setTimeout 함수를 만나게 되죠. 문제는 setTimeout 함수는 1초가 지날 때 까지 내부 함수를 실행하지 않고 대기한다는 겁니다. for문은 속도가 아주 빠르므로 1초보다 훨씬 짧은 시간에 다음 i로 넘어가게 되고 또 다시 setTimeout을 실행합니다. 이렇게 아주 짧은 시간에 0~3까지 4번의 setTimeout이 실행됩니다. for문이 끝났을 때의 실행컨텍스트는 아래와 같습니다. GO( i=4 ) for 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) setTimeout 컨텍스트 ( empty ) 자, 이제 1초가 지났습니다. 3,4,5,6의 setTimeout 함수는 i 프로퍼티를 내부에 가지고 있지 않습니다. 따라서 상위에 있는 for 컨텍스트를 바라보게 되죠. for에도 i가 없으므로 GO로 갑니다. GO는 i를 4로 저장하고 있네요. 결과는 어떻게 될까요? 당연히 4를 거의 동시에 4번 출력하게 됩니다. 이제 문제를 해결해볼까요?? 중요한 점은 setTimeout 함수가 참조하는 i가 1초 후에도 변함없이 유지 되어야한다는 겁니다. for 컨텍스트는 i를 빠르게 변경하므로 i를 유지할 수가 없죠. 이것은 즉시실행함수(IIFE)를 이용하면 해결할 수 있습니다. 즉시실행함수는 함수를 선언과 동시에 실행하는 것을 말합니다. 예시를 보죠. (x => {   console.log(x) })(5) 위 결과는 5를 출력합니다. 익명함수 x => {...}를 ( )로 감싸고 곧바로 인자(5)를 넘겨주면 내부 함수가 실행되는 원리입니다. 이제 실행컨텍스트를 살펴볼까요? GO ( empty ) 즉시실행함수 컨텍스트 ( x = 5 ) console.log는 x를 참조합니다. x는 즉시실행함수에 저장되어 있네요. 즉 console.log는 5를 출력하게 됩니다. 감이 좀 오시나요? 즉시 실행함수는 새로운 컨텍스트를 만들어주고, 인자로 받은 값을 컨텍스트에 저장할 수 있습니다. 바로 이 점을 활용하는거죠. [솔루션] 아래가 바로 정답 코드입니다. for(var i=0; i&lt;4; i++){   (x => {    setTimeout(() => {      console.log(x)   },1000*x)  })(i) }​ 1초 후의 실행컨텍스트를 살펴봅시다. GO( i=4 ) for 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=0 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=1 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=2 ) setTimeout 컨텍스트 ( empty ) 즉시실행함수 컨텍스트 ( x=3 ) setTimeout 컨텍스트 ( empty ) 자, 어떤가요? 1초가 지난 후에 setTimeout이 실행되어도 x가 저장되어있으므로 x초마다 x를 출력할 수 있겠지요? 긴 글 읽어주셔서 감사합니다. 😍 추가) for문에서 let으로 만든 변수는 반복될 때마다 새로운 실행컨텍스트를 생성합니다. 따라서 var 변수를 let으로 변경하기만 해도 i값을 유지할 수 있답니다. ^^ 아래 코드로 간단하게 해결이 되네요! for(let i=0; i&lt;4; i++){   setTimeout(() => {     console.log(i) },1000*i) }​ GO( empty ) for 컨텍스트 ( i = 0) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 1) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 2) setTimeout 컨텍스트 ( empty ) for 컨텍스트 ( i = 3) setTimeout 컨텍스트 ( empty ) 참고) 같은 비동기 함수인 setInterval()을 이용하는 방법도 있어요. 취향대로 선택하셔서 사용하세요. ^^; // setInterval() 사용 let i = 0 console.log(i++) let interval = setInterval(() => {  console.log(i++)  if(i >= 4) clearInterval(interval) }, 1000)​</div></div><div class="EmojiDiv"><span class="Emoji"><span>😄</span><span>🤣</span><span>🥰</span><span>😍</span><span>😝</span><span>😭</span><span>👍</span><span>🐕</span><span>🐈</span><span>☀</span><span>🌙</span><span>⭐</span><span>☁</span><span>🌧</span><span>💧</span><span>♥</span><span>❤</span><span>💕</span><span class="EmojiLink">[이모지🔗]</span></span></div><div class="writeComment"><div class="commentProfile"><img src="/images/noavatar.png" alt="PROFILE"></div><div class="commentContent"><button class="loginButton">로그인</button><textarea style="height:24px" readonly placeholder=" 로그인 후에 댓글을 남겨주세요 😄"></textarea></div></div><div class="commentButtons"></div><div id="comments"><div class="commentTitle"><div class="commentCnt">댓글 1개</div><span class="commentRefresh">댓글 새로고침 <svg viewBox="0 0 24 24" class="MuiSvgIcon-root" aria-hidden="true" focusable="false"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path></svg></span></div><div class="commentWrapper" id="comment_33_1"><div class="comment"><div class="commentProfile"><img src="https://phinf.pstatic.net/contact/20201010_196/1602333058599N1lSW_PNG/image.png" alt="PROFILE"></div><div class="commentContent"><span class="commentUsername">imki123</span><span class="commentDate"> - 2020-11-08 21:34 (수정됨)</span><textarea style="height:100px" readonly></textarea></div></div></div></div></div><textarea style="height:0;width:371px" disabled id="fakeTextarea"></textarea></div></div></div></div><script>!function(e){function r(r){for(var n,i,l=r[0],f=r[1],a=r[2],c=0,s=[];c<l.length;c++)i=l[c],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&s.push(o[i][0]),o[i]=0;for(n in f)Object.prototype.hasOwnProperty.call(f,n)&&(e[n]=f[n]);for(p&&p(r);s.length;)s.shift()();return u.push.apply(u,a||[]),t()}function t(){for(var e,r=0;r<u.length;r++){for(var t=u[r],n=!0,l=1;l<t.length;l++){var f=t[l];0!==o[f]&&(n=!1)}n&&(u.splice(r--,1),e=i(i.s=t[0]))}return e}var n={},o={1:0},u=[];function i(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=e,i.c=n,i.d=function(e,r,t){i.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,r){if(1&r&&(e=i(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)i.d(t,n,function(r){return e[r]}.bind(null,n));return t},i.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(r,"a",r),r},i.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},i.p="/";var l=this.webpackJsonpblog_imki123=this.webpackJsonpblog_imki123||[],f=l.push.bind(l);l.push=r,l=l.slice();for(var a=0;a<l.length;a++)r(l[a]);var p=f;t()}([])</script><script src="/static/js/2.d6e52bf1.chunk.js"></script><script src="/static/js/main.b119eae1.chunk.js"></script></body></html>